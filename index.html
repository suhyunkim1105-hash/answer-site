<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>answer-site ì¹´ë©”ë¼ + AI í’€ì´(1~5)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #111;
      color: #eee;
      margin: 0;
      padding: 16px;
    }
    h1 { font-size: 1.4rem; margin-bottom: 0.5rem; }
    p  { font-size: 0.9rem; color: #bbb; }
    .section { margin-top: 16px; }
    video {
      width: 100%;
      max-width: 480px;
      background: #000;
      border-radius: 10px;
      margin-top: 12px;
    }
    button {
      margin-top: 8px;
      padding: 10px 16px;
      font-size: 15px;
      border-radius: 999px;
      border: none;
      background: #2a2a2a;
      color: #fff;
    }
    button:active { opacity: 0.8; }
    #status, #solveStatus {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #ccc;
      white-space: pre-line;
    }
    textarea {
      width: 100%;
      max-width: 480px;
      border-radius: 8px;
      border: 1px solid #444;
      background: #181818;
      color: #eee;
      padding: 8px;
      font-size: 0.9rem;
      margin-top: 8px;
    }
    #answerArea {
      font-size: 2rem;
      font-weight: bold;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <h1>ì¹´ë©”ë¼ í…ŒìŠ¤íŠ¸ + AI ìë™ í’€ì´(1~5)</h1>
  <p>1ë‹¨ê³„: ì¹´ë©”ë¼ëŠ” ìœ„ì—ì„œ í™•ì¸ìš©, ë¬¸ì œëŠ” ì•„ë˜ì— ì§ì ‘ ë¶™ì—¬ë„£ê³  AIê°€ 1~5 ì¤‘ í•˜ë‚˜ë§Œ ê³ ë¥´ê²Œ ë§Œë“ ë‹¤.</p>

  <!-- ì¹´ë©”ë¼ ì˜ì—­ (ê·¸ëƒ¥ ë¯¸ë¦¬ë³´ê¸°/í™•ì¸ìš©) -->
  <div class="section">
    <h2 style="font-size:1.1rem;">ğŸ“· ì¹´ë©”ë¼ í™”ë©´</h2>
    <button id="startBtn">ì¹´ë©”ë¼ ì¼œê¸°</button>
    <div id="status">ëŒ€ê¸° ì¤‘...</div>
    <video id="video" autoplay playsinline muted></video>
  </div>

  <!-- ë¬¸ì œ í…ìŠ¤íŠ¸ ì…ë ¥ + AI í’€ì´ -->
  <div class="section">
    <h2 style="font-size:1.1rem;">ğŸ“ ë¬¸ì œ í…ìŠ¤íŠ¸</h2>
    <p style="font-size:0.85rem; color:#bbb;">
      ì•„ë˜ì— <b>ë¬¸ì œ + ë³´ê¸° 1~5</b>ë¥¼ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ê³ , <b>AI í’€ì´ ë²„íŠ¼</b>ì„ ëˆ„ë¥´ë©´ 1~5 ì¤‘ ì •ë‹µ ë²ˆí˜¸ë§Œ ë‚˜ì˜¨ë‹¤.
    </p>
    <textarea id="questionText" rows="10"
      placeholder="ì˜ˆì‹œ:
In recent years, many universities have started offering online courses...

Question:
What is the main purpose of the passage?
1. ...
2. ...
3. ...
4. ...
5. ..."></textarea>
    <button id="solveBtn">ì´ í…ìŠ¤íŠ¸ë¡œ AI í’€ì´ ìš”ì²­ (1~5)</button>
    <div id="solveStatus">ì•„ì§ í’€ì´ ìš”ì²­ ì—†ìŒ</div>
  </div>

  <!-- ì •ë‹µ í‘œì‹œ -->
  <div class="section">
    <h2 style="font-size:1.1rem;">âœ… AI ì •ë‹µ (1~5 ë²ˆí˜¸)</h2>
    <div id="answerArea">ì•„ì§ ì •ë‹µ ì—†ìŒ</div>
  </div>

  <script>
    // ------- ì¹´ë©”ë¼ ë¶€ë¶„ (ì´ë¯¸ ì˜ ë˜ë˜ ì½”ë“œ ê¸°ë°˜) -------
    const startBtn   = document.getElementById('startBtn');
    const statusEl   = document.getElementById('status');
    const video      = document.getElementById('video');

    let stream = null;

    async function startCamera() {
      statusEl.textContent = 'ë²„íŠ¼ ëˆŒë¦¼ â†’ ì¹´ë©”ë¼ ìš”ì²­ ì¤‘...';

      try {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          statusEl.textContent = 'ì´ ë¸Œë¼ìš°ì €ëŠ” getUserMediaë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
          return;
        }

        if (stream) {
          statusEl.textContent = 'ì´ë¯¸ ì¹´ë©”ë¼ê°€ ì¼œì ¸ ìˆìŠµë‹ˆë‹¤.';
          return;
        }

        stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: 'environment' },
          audio: false,
        });

        video.srcObject = stream;

        video.addEventListener(
          'loadedmetadata',
          () => {
            statusEl.textContent =
              'ì¹´ë©”ë¼ ì—°ê²° ì„±ê³µ âœ…\\nì‹¤ì œ í•´ìƒë„: ' +
              video.videoWidth + ' x ' + video.videoHeight;
          },
          { once: true }
        );
      } catch (err) {
        console.error(err);
        statusEl.textContent =
          'ì¹´ë©”ë¼ ì˜¤ë¥˜ âŒ\\n' +
          'ë©”ì‹œì§€: ' + err.name + ' - ' + err.message +
          '\\në¸Œë¼ìš°ì € ì£¼ì†Œì°½ ì˜† ìë¬¼ì‡  ì•„ì´ì½˜ì—ì„œ ì¹´ë©”ë¼ ê¶Œí•œì´ ì°¨ë‹¨ë¼ ìˆì§€ ì•Šì€ì§€ í™•ì¸í•´.';
        alert('ì¹´ë©”ë¼ ì˜¤ë¥˜: ' + err.name + '\\n' + err.message);
      }
    }

    startBtn.addEventListener('click', startCamera);

    // ------- AI í’€ì´(1~5) ë¶€ë¶„ -------
    const questionTextEl = document.getElementById('questionText');
    const solveBtn       = document.getElementById('solveBtn');
    const solveStatus    = document.getElementById('solveStatus');
    const answerArea     = document.getElementById('answerArea');

    async function solveQuestion() {
      const text = questionTextEl.value.trim();
      if (!text) {
        alert('ë³´ë‚¼ ë¬¸ì œ í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      solveStatus.textContent = 'AI í’€ì´ ì¤‘...';
      answerArea.textContent  = '...';

      try {
        const res = await fetch('/.netlify/functions/solve', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question: text }),
        });

        if (!res.ok) {
          throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + res.status);
        }

        const data = await res.json();
        answerArea.textContent = data.answer || 'ì‘ë‹µ í¬ë§· ì˜¤ë¥˜';
        solveStatus.textContent = 'í’€ì´ ì™„ë£Œ.';
      } catch (err) {
        console.error(err);
        solveStatus.textContent = 'í’€ì´ ì˜¤ë¥˜: ' + err.message;
        alert('í’€ì´ ì˜¤ë¥˜: ' + err.message);
      }
    }

    solveBtn.addEventListener('click', solveQuestion);
  </script>
</body>
</html>
