<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>answer-site ì›ê²© ì»¨íŠ¸ë¡¤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #111;
      color: #eee;
      margin: 0;
      padding: 16px;
    }
    h1 { font-size: 1.4rem; margin-bottom: 0.5rem; }
    p  { font-size: 0.9rem; color: #bbb; }
    .section { margin-top: 16px; }
    button {
      margin-top: 8px;
      padding: 10px 16px;
      font-size: 15px;
      border-radius: 999px;
      border: none;
      background: #2a2a2a;
      color: #fff;
    }
    button:active { opacity: 0.8; }
    #status {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #ccc;
      white-space: pre-line;
    }
    img {
      width: 100%;
      max-width: 480px;
      background: #000;
      border-radius: 10px;
      display: block;
      margin-top: 12px;
    }
    textarea {
      width: 100%;
      max-width: 600px;
      border-radius: 8px;
      border: 1px solid #444;
      background: #181818;
      color: #eee;
      padding: 8px;
      font-size: 0.9rem;
      margin-top: 8px;
    }
    #remoteAnswer {
      font-size: 2.5rem;
      font-weight: bold;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <h1>ğŸ’» ì›ê²© ìº¡ì²˜ + ìë™ í’€ì´ ì»¨íŠ¸ë¡¤ëŸ¬</h1>
  <p>
    ì´ í˜ì´ì§€ë¥¼ ë…¸íŠ¸ë¶ì—ì„œ ì—´ê³ , ê°™ì€ ì‚¬ì´íŠ¸ì˜ <code>index.html</code>ì„ íœ´ëŒ€í°ì—ì„œ ì—° ë’¤<br />
    ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ íœ´ëŒ€í° ì¹´ë©”ë¼ì—ì„œ ìº¡ì²˜ + OCR + í’€ì´ë¥¼ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ ì—¬ê¸°ì„œ ë³¼ ìˆ˜ ìˆë‹¤.
  </p>
  <p style="font-size:0.85rem;">
    ROOM_ID: <code>room1</code> (index.htmlê³¼ ë°˜ë“œì‹œ ë™ì¼í•´ì•¼ í•¨)
  </p>

  <button id="captureBtn">ğŸ“¸ íœ´ëŒ€í°ì— ì›ê²© ìº¡ì²˜ + í’€ì´ ìš”ì²­</button>
  <div id="status">ëŒ€ê¸° ì¤‘...</div>

  <div class="section">
    <h2 style="font-size:1.1rem;">ğŸ–¼ ë§ˆì§€ë§‰ ìº¡ì²˜ ì´ë¯¸ì§€</h2>
    <img id="previewImage" alt="ì•„ì§ ìº¡ì²˜ ì—†ìŒ" />
  </div>

  <div class="section">
    <h2 style="font-size:1.1rem;">ğŸ“ OCR í…ìŠ¤íŠ¸</h2>
    <textarea id="remoteText" rows="10" readonly></textarea>
  </div>

  <div class="section">
    <h2 style="font-size:1.1rem;">âœ… AI ì •ë‹µ (1~5 ë²ˆí˜¸)</h2>
    <div id="remoteAnswer">ì•„ì§ ì •ë‹µ ì—†ìŒ</div>
  </div>

  <script type="module">
    import { initializeApp }   from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // index.htmlê³¼ ê°™ì€ Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyAvjpHfmbuHQq3ZeV6mNKQFI9LsnX-vf68",
      authDomain: "answer-site-p2p.firebaseapp.com",
      databaseURL: "https://answer-site-p2p-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "answer-site-p2p",
      storageBucket: "answer-site-p2p.firebasestorage.app",
      messagingSenderId: "364227113735",
      appId: "1:364227113735:web:b18355cf0b16454663cba2",
      measurementId: "G-C8MRHK5ZGS"
    };

    const ROOM_ID = "room1";

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);
    const commandRef = ref(db, `rooms/${ROOM_ID}/command`);
    const resultRef  = ref(db, `rooms/${ROOM_ID}/result`);

    const captureBtn   = document.getElementById('captureBtn');
    const statusEl     = document.getElementById('status');
    const previewImage = document.getElementById('previewImage');
    const remoteText   = document.getElementById('remoteText');
    const remoteAnswer = document.getElementById('remoteAnswer');

    let requestCounter = 0;

    captureBtn.addEventListener('click', async () => {
      requestCounter += 1;
      const reqId = requestCounter;

      statusEl.textContent = `ìº¡ì²˜ ìš”ì²­ ì „ì†¡ ì¤‘... (ID: ${reqId})`;
      try {
        await set(commandRef, {
          type: 'capture',
          requestId: reqId,
          sentAt: Date.now()
        });
        statusEl.textContent = `ìº¡ì²˜ ìš”ì²­ ì „ì†¡ ì™„ë£Œ. (ID: ${reqId}) íœ´ëŒ€í°ì´ ì²˜ë¦¬ ì¤‘...`;
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'ìº¡ì²˜ ìš”ì²­ ì¤‘ ì˜¤ë¥˜: ' + err.message;
      }
    });

    // íœ´ëŒ€í°ì—ì„œ ë³´ë‚¸ ê²°ê³¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°›ê¸°
    onValue(resultRef, (snapshot) => {
      const val = snapshot.val();
      if (!val) return;

      if (val.image) {
        previewImage.src = val.image;
      }
      remoteText.value         = val.text   || '';
      remoteAnswer.textContent = val.answer || 'ì‘ë‹µ ì—†ìŒ';

      const t = val.updatedAt ? new Date(val.updatedAt) : new Date();
      statusEl.textContent = `ë§ˆì§€ë§‰ ì‘ë‹µ - ìš”ì²­ ID: ${val.requestId || 'ì—†ìŒ'} / ì‹œê°„: ${t.toLocaleTimeString()}`;
    });
  </script>
</body>
</html>
